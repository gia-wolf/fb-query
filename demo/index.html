<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    
    <title>firebase-addons.Demo</title>
    <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../firebase-query.html">
    <link rel="import" href="../page-collection.html">
    <!-- <link rel="import" href="../page-template-img.html"> -->
    <link rel="import" href="../page-template-div.html">

    <style is="custom-style">
      :root {
        /*--login-background-color: lightgray;
        --login-button-color: blue;
        --login-button-background-color: orange;*/
      }
      .orange {
        padding: 0 5px;
        background-color: orange;
      }
      .form-text {
        margin-right: 1em;
        margin-bottom: 0.5em;
      }
    </style>

  </head>
  
  <body unresolved>

    <template is="dom-bind" id="demo">  

      <h4>An example of <code>&lt;firebase-query(-button)&gt;</code>:</h4>
      <div class="layout horizontal end">
        <div class="form-text"> Query album for </div> 
        <paper-input id="year" label="year"></paper-input>
      </div>

      <template is="dom-if" if="{{year}}">
        <!-- <firebase-query -->
        <div class="layout horizontal">
          <h4>{{pages.length}} pages queried for {{year}}</h4>
          <firebase-query-button
            id   ="demobutton" 
            icon ="[[pageicon]]" 
            location    ="[[location]]" 
            query       = "[[pagequery]]" 
            recorditems = "[[pageitems]]" 
            recordindex = "{{pageindex}}" 
            responserecords = "{{pages}}" 
            auth    = "[[auth]" 
          >
          </firebase-query-button>
          <!-- </firebase-query> -->
        </div>
      </template>

      <template is="dom-if" if="{{pageindex}}">

        <hr>
        <div class="layout horizontal">
          <div class="orange">Page actually viewed:</div>
          <div class="flex"><b>{{activatePage(pageindex, pages)}}</b></div>
        </div>

        <!-- <p> from <i>{{location}}</i> by <code>{{pagequery}}</code> as record: [<i>{{pageitems}}</i>]</p> -->

        <template is="dom-if" if="{{sectionquery}}">
          <!--  -->          
          <firebase-query 
            location    = "[[location]]" 
            query       = "[[sectionquery]]" 
            recorditems = "record" 
            responserecords = "{{sections}}"
            auth        = "[[auth]]">
          </firebase-query>

          <template is="dom-repeat" items="[[sections]]" as="section">
            
            <div class="layout horizontal">
              <div><button>Download</button></div>
              <div>Section - {{section._ix}}: <b>{{section.title}}</b></div>
            </div>

            <page-collection> <!-- collection="[[section.imas]]" -->
              
              <template is="dom-repeat" items="[[section.imas]]"> <!-- as="img" -->

                <page-template item="{{item}}">
                </page-template> 
              
              </template>
            
            </page-collection>

          </template>            

        </template>

      </template>

    </template>

    <script>
    
      var d = document.querySelector('#demo'); 

      d.addEventListener('dom-change', function() {

        this.$.year.addEventListener('change', function() {
          d.year = null;
          d.pageindex = null;
          if (this.value.length==4) {
            d.year = this.value;
            d.pagequery = "/fotoalben/"+d.year+"/pages";  console.log("pagequery: ", d.pagequery)
          } 
        });   

        d.location = "https://intense-heat-7852.firebaseio.com";
        d.auth     = "anonymous";

        d.pages    = [];
        d.sections = [];
      
        // Page-abfrage
        // d.pageicon  = "query-icons:group";
        // d.pageicon  = "query-icons:photo-album";
        d.pageicon  = "query-icons:view-list";

        d.year      = "2015"
        d.pagequery = "/fotoalben/"+d.year+"/pages";
        d.pageitems = "title";

        d.pageindex = "";

        d.sectionquery = "";

        d.activatePage = function(index, records) {
          if (!records || !records.length) return ; // console.log("LOG.activatePage. ", index, records); 
          var rec; 
          for (var i = 0; i < records.length; i++) {
              rec = records[i]; 
              if (rec._ix == index) {
                this.sectionquery = this.pagequery+"/"+index+"/sections"; 
                return rec._txt;
              }   
          }
          return;
        };

      });
        
      // var demoButton = document.querySelector('#demobutton'); 
      // console.log("demoButton:", demoButton);

    </script>

  </body>

</html>
